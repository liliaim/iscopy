 document.addEventListener("DOMContentLoaded", async function() {
    const map = "<%= asset_path('map-full.svg') %>";
    const container = document.querySelector('#map');

    const res = await fetch(map);

    if (res.ok) {
      const svg = await res.text();
      container.innerHTML = svg;

      const prefectureElements = document.querySelectorAll(".prefecture");
      const prefCodes = JSON.parse(container.getAttribute("data-pref-codes")); //計画がある都道府県のprefecture_id
      const prefRecCodes = JSON.parse(container.getAttribute("data-rec-codes")); //計画がある都道府県のprefecture_id

      prefectureElements.forEach(prefecture => {
        const svgDataCode = parseInt(prefecture.getAttribute("data-code")); //各都道府県のdata-code
        let prefColor = ""
        if ((prefCodes.includes(svgDataCode))&&(prefRecCodes.includes(svgDataCode))) {
          prefecture.style.fill = "#00ffff"; // 計画と記録の両方ある都道府県を水色で塗りつぶす
          prefColor = "#00ffff";
        }else if ((prefCodes.includes(svgDataCode)) && !(prefRecCodes.includes(svgDataCode))) {
           prefecture.style.fill = "#1e90ff"; // 計画がある都道府県を青色で塗りつぶす
          prefColor = "#1e90ff";
        }else if (!(prefCodes.includes(svgDataCode)) && (prefRecCodes.includes(svgDataCode))) {
          prefecture.style.fill = "#00fa9a"; // 記録がある都道府県を緑色で塗りつぶす
          prefColor = "#00fa9a";
        } else {
          prefecture.setAttribute("fill", "#f0f0f0"); // その他の都道府県はグレー色で塗りつぶす
          prefColor = "#f0f0f0";
        }

        // マウスオーバーで色を変える
        prefecture.addEventListener( 'mouseover', ( event ) => {
          event.currentTarget.style.fill = "#ffac30"
        } )
        // マウスが離れたら色をもとに戻す
        prefecture.addEventListener( 'mouseleave', ( event ) => {
          event.currentTarget.style.fill = prefColor
        });

        prefecture.addEventListener("click", function() {      
          // 対応する都道府県のplan_pathにリダイレクト
          window.location.href = `/plans/${svgDataCode}`;
        });
      });
    }
  });

